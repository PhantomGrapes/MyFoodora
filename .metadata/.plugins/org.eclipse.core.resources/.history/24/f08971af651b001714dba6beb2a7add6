package myFoodora;

import java.util.ArrayList;

import item.Order;
import policy.DeliveryPolicy;
import policy.TargetProfitPolicy;
import user.Courier;
import user.Customer;
import user.Restaurant;
import user.User;

public class MyFoodora {
	ArrayList<User> users;
	ArrayList<Restaurant> restaurants;
	ArrayList<Customer> customers;
	ArrayList<Courier> couriers;
	DeliveryPolicy deliveryPolicy;
	TargetProfitPolicy targetProfitPolicy;
	double serviceFee;
	double markup;
	double deliveryCost;
	ArrayList<Order> orders;
	public double getServiceFee() {
		return serviceFee;
	}
	public void setServiceFee(double serviceFee) {
		this.serviceFee = serviceFee;
	}
	public double getMarkup() {
		return markup;
	}
	public void setMarkup(double markup) {
		this.markup = markup;
	}
	public double getDeliveryCost() {
		return deliveryCost;
	}
	public void setDeliveryCost(double deliveryCost) {
		this.deliveryCost = deliveryCost;
	}
	
	
	public ArrayList<Order> getOrders() {
		return orders;
	}
	public void setOrders(ArrayList<Order> orders) {
		this.orders = orders;
	}
	public TargetProfitPolicy getTargetProfitPolicy() {
		return targetProfitPolicy;
	}
	public void setTargetProfitPolicy(TargetProfitPolicy targetProfitPolicy) {
		this.targetProfitPolicy = targetProfitPolicy;
	}
	public void addUser(User user){
		users.add(user);
		if(user instanceof Customer)
			customers.add((Customer) user);
		if(user instanceof Restaurant)
			restaurants.add((Restaurant) user);
		if(user instanceof Courier)
			couriers.add((Courier) user);
	}
	
	public void removeUser(User user){
		users.remove(user);
		if(user instanceof Customer)
			customers.remove((Customer) user);
		if(user instanceof Restaurant)
			restaurants.remove((Restaurant) user);
		if(user instanceof Courier)
			couriers.remove((Courier) user);
	}
	
	public void sendEmailTo(Customer customer, String message){
		if(customer.getEmail() == null || customer.getEmail() == ""){
			System.out.println("Can't find email address");
			return;
		}
		// send email
		System.out.println("Already send email to "+customer.getName()+" "+customer.getSurname());
	}
	
	public void sendSMSTo(Customer customer, String message){
		if(customer.getPhoneNumber() == null || customer.getPhoneNumber() == ""){
			System.out.println("Can't find phone number");
			return;
		}
		// send SMS
		System.out.println("Already send SMS to "+customer.getName()+" "+customer.getSurname());
	}
	
	public void notifyUsers(String message){
		for (Customer customer : customers) {
			if(customer.isCanBeNotified()){
				if(customer.isNotifiedByEmail()){
					sendEmailTo(customer, message);
				}
				else
					sendSMSTo(customer, message);
			}
		}
	}
	
	public void activeUser(User user){
		user.setActive(true);
	}
	
	public void desactiveUser(User user){
		user.setActive(false);
	}
	
	public void allocateCourier(Order order){
		ArrayList<Courier> cs = deliveryPolicy.sort(couriers, order.getCustomer());
		if(cs == null || cs.size() == 0){
			System.out.println("No courier on duty");
			return;
		}
		// haven't get into Internet, so we assume that courier accepts every order
		cs.get(0).acceptTheOrder(order);
	}
}
